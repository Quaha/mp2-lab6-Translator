# Translator

Данный проект представляет из себя реализацию своего языка программирования.

**Стек:** C++, Google Test, CMake, Antlr4

## Как установить?
Для установки достаточно просто клонировать репозиторий, но при необходиомсти изменить грамматику требуется:
1) Установить Java: https://www.java.com/ru/download/
2) Установить Anaconda с добавлением в PATH: https://www.anaconda.com/download/

## Как собрать?
1) Запустить BUILD_RELEASE.bat
2) В папке build открыть .sln файл
3) Выбрать режим запуска release и interface как запускаемый проект

### Как запустить?
Файл console_interface содержит функцию main, в её начале есть константа, которая отвечает за режим запуска:
- Режим интерпретатора (построчное считывание и выполнение с выводом всех получаемых значений)
- Режим компилятора (считывание блока кода и вывод только указанных значений)

## Структура проекта
1) core:
   - include и src - исходный код проекта
   - antlr - исходный код собранной библиотеки
2) build - собранное решение
3) external - сторонние библиотеки:
    - исходный код antlr4 для сборки динамической библиотеки
    - google tests
4) grammar - содержит описание грамматики, скрипт для получения файлов C++ (и сами файлы), визуализатор дерева
5) interface - .cpp файл с точкой входа
6) tests - исходные коды тестов 

### core
- CalcEvalVisitor - переопределение методов обхода дерева
- common - некоторые enum'ы и другие вспомогательные объявления
- Data - реализация класса Data - обёртка над std::any, которая содержит дополнительную информацию
- DataMath - реализация математических функций для значений, которые лежат в Data
- Interpreter - реализации функции, возврающей std::vector<Data> с результатом выполнения каждой строки
- ThrowingErrorListener - перегрузка класса, выбрасывающего исключения, чтобы выбрасывались исключения
- ProgramMemory - содержит класс, представляющий память интерпретатора. В неё загружены функции, которые могут быть вызваны, а так же там хранятся переменные.

## Описание языка и модель исполнения

Интерпретатор выполняет программу, которая состоит из строк, разделённых `;` (а также `;` в конце). Результатом исполнения каждой строки является какое-то значение (при его отсутствии - None),
которое возвращается вместе со всеми остальными в std::vector<Data>, после загрузки программы в интерпретатор. Консольный интерфейс в режиме интерпретатор выводит полученные значения, в режиме
компилятора он считывает многострочную команду и выводит что-либо только при вызове определённых функций.

### Математические операции

Интерпретатор поддерживает базовые математические операции. Он может работать с **целыми числами** (внутри они представлены как long long) и **вещественными числами**
(внутри они представлены как long double). При возможности вычисления всего выражения в целочисленном типе - это происходит, иначе происходит преобразование к вещественному типу.
Интерпретатор поддерживает операторы `+`, `-`, `*`, `/`, `%` причём операторы `+` и `-` есть как в бинарном, так и в унарном варианте, а оператор `/` различается в зависимости от типа аргументов
(если оба операнда - целые числа, то происходит деление с округлением вниз, иначе вещественное деление). Оператор `%` выполняет деление по модулю, поэтому он определён только для целых чисел.
Также поддерживаются скобки `(` и `)` для управления приоритетом операций. Приоритет операций
совпадает с приоритетом в математике.

```cpp
-3*(6+4);2.2/2;
>> -30
>> 1.1
```

### Переменные

Программа поддерживает запись переменных с помощью оператора `=`. Этот оператор имеет самый низкий приоритет среди остальных и требует в качестве левого аргумента переменную, в качестве правого значение, содержащее внутри себя
или являющееся числом. При попытке использовать непроинициализированную переменную выбрасывается исключение. Оператор `=` возвращает число, которое было присвоено переменной. При написании программ стоит учитывать, что переменная является
таковой, пока к ней не была применена операция, которая извлекает из неё значение, т.е., например, если `a` это переменная, то `a+5` - уже нет.

```cpp
a=5;
>>5;
b=c=a;
>>5;
e;
<Ошибка>
a=(b+5=6);
<Ошибка>
```

Существующие переменные можно удалять из памяти с помощью функции `delete(<имя>)`, она возвращает значение переменной из памяти.

### Функции

Есть поддержка функций. Функции имеют следующий вид: `<name>(arg1,arg2,...)`. Имя удовлетворяет правилам написания имён переменных, число аргументов может любое (от 0 до неограниченного).
В данный момент реализованы следующие функции.

#### sum()
`sum(arg1,arg2,...)` - эта функция принимает произвольное число значений, возвращает их сумму. Если все аргументы целочисленны, то результат будет целым, иначе вещественным.

#### abs()
`abs(arg1)` - эта функция принимает ровно одно значение в качестве аргумента и, если оно отрицательно, меняет его знак. Данная функция не меняет тип значения с вещественного на целый или обратно.

#### print()
`print(arg1)` - эта функция выводит значение в консоль (актуально в режиме компилятора)

#### Добавление функций
Для добавления функции нужно добавить её объявление и реализацию в DataMath, а также добавить её инициализацию в памяти в функции `initMemory()` в ProgramMemory.

### Логический тип данный
Такой тип данных отсутствует, его заменяет целочисленный тип. Реализованы все логические операторы (`!`, `&&`, `||`, `==`, `!=`, `<`, `>`, `<=', `>=`), при работе с ними любое значение переводится в целочисленный 0,
если оно равно 0, иначе в целочисленную 1. Операторы также возвращают целочисленные 0 или 1. Приоритет у груп операторов следующий: логические И, ИЛИ - сравнение - равенство - отрицание. Внутри каждой группы приоритет
определён некоторым образом (для логического И и ИЛИ он выше у И), поэтому при использовании в одном выражении нескольких операторов одной группы следует расставлять скобки.

```cpp
(1&&3)<(1+4);
>> 1
```

### Условные выражения

Условные выражения имеют следующий вид:

```cpp
if(<условие>){
    <код>
};

if(<условие>){
    <код>
}
else {
    <код>
};
```

При работе с интерфейсом в режиме онлайн будут сначала выведены значения, полученные из кода в соответствующем блоке, а затем 0 или 1, в зависимости от того, истино ли условие.

### Циклы

Реализован цикл `while`:

```cpp
while(<условие>) {
    <код>
};
```

При работе с интерфейсом в режиме онлайн будут сначала выведены значения, полученные из кода в цикле, а затем число итераций цикла.



### Примеры программ
#### Вычисление факториала
```cpp
N = 10;
result = 1;
i = 0;
while (i < N) {
    result = result * (i + 1);
    i = i + 1;
};
print(result);


>> 3628800
```

#### Вывод всех простых числе до N
```cpp
N = 100;
i = 2;
while (i < N) {
    flag = 1;
    j = 2;
    while (j * j <= i) {
        if ((i % j) == 0) {
            flag = 0;
        };
        j = j + 1;
    };
    if (flag) {
        print(i);
    };
    i = i + 1;
};

>> 2
>> 3
>> 5
>> 7
>> 11
>> 13
>> 17
>> 19
>> 23
>> 29
>> 31
>> 37
>> 41
>> 43
>> 47
>> 53
>> 59
>> 61
>> 67
>> 71
>> 73
>> 79
>> 83
>> 89
>> 97
```

